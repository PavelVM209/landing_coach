# Инструкция по исправлению проблемы с доступом к /coaching

Эта инструкция поможет вам исправить проблему, из-за которой страница обучения не отображается по адресу https://fastpassnews.ru/coaching и вместо этого происходит перенаправление на dashboard.html.

## Причина проблемы

В основной конфигурации Nginx блок `location /` перехватывает все запросы, включая `/coaching`, и перенаправляет их на порт 3000, где работает основное приложение. Необходимо настроить маршрут `/coaching` по аналогии с маршрутом `/landing`, который работает корректно.

## Способы решения

### Вариант 1: Автоматическое обновление (рекомендуется)

1. Клонируйте или обновите репозиторий:
   ```bash
   # Если у вас уже есть репозиторий
   cd /opt/landing_coach
   git pull
   
   # Если репозиторий еще не клонирован
   git clone https://github.com/yourusername/landing_coach.git /opt/landing_coach
   ```

2. Запустите специальный скрипт обновления Nginx:
   ```bash
   cd /opt/landing_coach
   sudo ./update_nginx.sh
   ```

3. Проверьте доступ к странице:
   ```bash
   # Проверка локального доступа
   curl http://localhost:3002
   
   # Проверка доступа через веб-браузер
   # Откройте https://fastpassnews.ru/coaching
   ```

### Вариант 2: Ручное обновление

Если автоматический скрипт не сработал, выполните следующие шаги вручную:

1. Найдите конфигурационный файл для вашего сайта:
   ```bash
   find /etc/nginx -name "fastpassnews.conf"
   # или
   find /etc/nginx -type f -exec grep -l "fastpassnews.ru" {} \;
   ```

2. Проверьте, как реализовано перенаправление для `/landing` в этом файле:
   ```bash
   grep -A 10 "location /landing" /путь/к/найденному/файлу
   ```

3. Используя конфигурацию `/landing` как образец, добавьте конфигурацию для `/coaching`:
   ```nginx
   # Добавьте этот блок после конфигурации для /landing или перед блоком location /
   location /coaching {
       proxy_pass http://localhost:3002/;
       proxy_http_version 1.1;
       proxy_set_header Upgrade $http_upgrade;
       proxy_set_header Connection 'upgrade';
       proxy_set_header Host $host;
       proxy_set_header X-Real-IP $remote_addr;
       proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
       proxy_set_header X-Forwarded-Proto $scheme;
       proxy_cache_bypass $http_upgrade;
       proxy_redirect off;
   }
   
   # Статические файлы
   location /coaching/css/ {
       proxy_pass http://localhost:3002/css/;
   }
   
   location /coaching/js/ {
       proxy_pass http://localhost:3002/js/;
   }
   
   location /coaching/images/ {
       proxy_pass http://localhost:3002/images/;
   }
   
   # API маршрут
   location /coaching/api/ {
       proxy_pass http://localhost:3002/api/;
   }
   ```

4. Проверьте конфигурацию и перезапустите Nginx:
   ```bash
   sudo nginx -t
   sudo systemctl reload nginx
   ```

## Проверка после исправления

После применения исправлений, проверьте:

1. Локальный доступ к приложению: `curl http://localhost:3002`
2. Доступ по URL: https://fastpassnews.ru/coaching
3. Правильную загрузку статических ресурсов (CSS, JavaScript, изображения)
4. Работу формы отправки заявок

## Устранение неполадок

Если после всех исправлений страница все еще недоступна:

1. Проверьте логи Nginx:
   ```bash
   sudo tail -f /var/log/nginx/error.log
   ```

2. Проверьте логи приложения:
   ```bash
   pm2 logs coaching-app
   ```

3. Убедитесь, что приложение запущено:
   ```bash
   pm2 status
   ```

4. Проверьте, что порт 3002 прослушивается:
   ```bash
   netstat -tuln | grep 3002
   ```

5. Временно отключите файрвол для проверки:
   ```bash
   sudo ufw disable  # На Ubuntu
   # или
   sudo systemctl stop firewalld  # На CentOS/RHEL
   ```

## Важные файлы

- `/opt/landing_coach/nginx/fastpassnews_coaching.conf` - Конфигурация для Nginx
- `/opt/landing_coach/update_nginx.sh` - Скрипт автоматического обновления Nginx
- `/opt/landing_coach/install.sh` - Скрипт установки
